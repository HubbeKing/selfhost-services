apiVersion: apps/v1
kind: Deployment
metadata:
  name: diun
spec:
  selector:
    matchLabels:
      app: diun
  template:
    metadata:
      labels:
        app: diun
    spec:
      serviceAccountName: diun
      containers:
        - name: diun
          image: docker.io/crazymax/diun:4.11.0
          env:
            - name: TZ
              value: "Europe/Helsinki"
            - name: LOG_LEVEL
              value: "info"
            - name: LOG_JSON
              value: "false"
            - name: DIUN_WATCH_WORKERS
              value: "20"
            - name: DIUN_WATCH_SCHEDULE
              value: "00 12 * * *"
            - name: DIUN_PROVIDERS_KUBERNETES
              value: "true"
            - name: DIUN_PROVIDERS_KUBERNETES_WATCHBYDEFAULT
              value: "true"
            - name: DIUN_REGOPTS_HUBBECLUB_NAME
              value: "registry.hubbe.club"
            - name: DIUN_REGOPTS_HUBBECLUB_SELECTOR
              value: "image"
            - name: DIUN_REGOPTS_HUBBECLUB_USERNAMEFILE
              value: /run/secrets/username
            - name: DIUN_REGOPTS_HUBBECLUB_PASSWORDFILE
              value: /run/secrets/password
          resources:
            limits:
              memory: 512Mi
              cpu: 500m
          volumeMounts:
            - mountPath: /data
              name: data
            - mountPath: /run/secrets/username
              name: auth
              subPath: username
            - mountPath: /run/secrets/password
              name: auth
              subPath: password
      volumes:
        - name: data
          persistentVolumeClaim:
            claimName: data-diun
        - name: auth
          secret:
            secretName: registry-auth
