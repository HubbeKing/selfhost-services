apiVersion: apps/v1
kind: Deployment
metadata:
  name: diun
spec:
  selector:
    matchLabels:
      app: diun
  template:
    metadata:
      labels:
        app: diun
      annotations:
        diun.watch_repo: "true"
    spec:
      serviceAccountName: diun
      containers:
        - name: diun
          image: docker.io/crazymax/diun:4.11.0
          envFrom:
            - configMapRef:
                name: diun-envs
          resources:
            limits:
              memory: 512Mi
              cpu: 500m
          volumeMounts:
            - mountPath: /data
              name: data
            - mountPath: /run/secrets/docker-username
              name: docker-auth
              subPath: username
            - mountPath: /run/secrets/docker-password
              name: docker-auth
              subPath: password
            - mountPath: /run/secrets/registry-username
              name: registry-auth
              subPath: username
            - mountPath: /run/secrets/registry-password
              name: registry-auth
              subPath: password
            - mountPath: /run/secrets/matrix-username
              name: matrix-auth
              subPath: username
            - mountPath: /run/secrets/matrix-password
              name: matrix-auth
              subPath: password
      volumes:
        - name: data
          persistentVolumeClaim:
            claimName: data-diun
        - name: docker-auth
          secret:
            secretName: docker-auth
        - name: registry-auth
          secret:
            secretName: registry-auth
        - name: matrix-auth
          secret:
            secretName: matrix-auth
