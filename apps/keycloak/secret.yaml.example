apiVersion: v1
kind: Secret
metadata:
  name: openldap-envs
stringData:
  LDAP_ORGANISATION: Hubbe Club
  LDAP_DOMAIN: hubbe.club
  LDAP_ADMIN_PASSWORD: ""
  LDAP_CONFIG_PASSWORD: ""
  LDAP_READONLY_USER: "true"
  LDAP_READONLY_USER_USERNAME: readonly
  LDAP_READONLY_USER_PASSWORD: ""
---
apiVersion: v1
kind: Secret
metadata:
  name: keycloak-db-envs
stringData:
  MYSQL_RANDOM_ROOT_PASSWORD: "yes"
  MYSQL_DATABASE: keycloak
  MYSQL_USER: keycloak
  MYSQL_PASSWORD: ""
---
apiVersion: v1
kind: Secret
metadata:
  name: keycloak-envs
stringData:
  TZ: Europe/Helsinki
  PROXY_ADDRESS_FORWARDING: "true"
  DB_VENDOR: mariadb
  DB_ADDR: keycloak-db
  DB_PORT: "3306"
  DB_DATABASE: keycloak
  DB_USER: keycloak
  DB_PASSWORD: ""
  KEYCLOAK_USER: admin
  KEYCLOAK_PASSWORD: ""
---
apiVersion: v1
kind: Secret
metadata:
  name: oauth2-proxy-config
stringData:
  oauth2-proxy.cfg: |
    http_address = "0.0.0.0:4180"
    reverse_proxy = true
    email_domains = [ "*" ]
    cookie_domains = [ ".hubbe.club" ]
    cookie_name = "_oauth2_proxy"
    cookie_secret = ""
    cookie_secure = true
    cookie_expire = "168h"
    cookie_refresh = "1h"
    cookie_httponly = true
    redirect_url = "https://login.hubbe.club/oauth2/callback"

    # keycloak provider
    provider = "keycloak"
    client_id = "oauth2-proxy"
    client_secret = ""
    login_url = "https://keycloak.hubbe.club/auth/realms/master/protocol/openid-connect/auth"
    redeem_url = "https://keycloak.hubbe.club/auth/realms/master/protocol/openid-connect/token"
    profile_url = "https://keycloak.hubbe.club/auth/realms/master/protocol/openid-connect/userinfo"
    validate_url = "https://keycloak.hubbe.club/auth/realms/master/protocol/openid-connect/userinfo"
    scope = "email"

    # allowed groups
    allowed_groups = [ "/admins" ]

    # allowed domains
    whitelist_domains = [ ".hubbe.club" ]
