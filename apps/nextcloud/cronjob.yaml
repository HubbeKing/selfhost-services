# CronJob to run /var/www/html/occ preview:pre-generate once an hour
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: nextcloud-preview-gen
spec:
  schedule: "37 * * * *"
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 1
  successfulJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: Never
          serviceAccountName: nextcloud-cron
          containers:
            - name: nextcloud-preview-gen
              image: docker.io/curlimages/curl:latest
              command: [ /preview-pre-generate.sh ]
              volumeMounts:
                - mountPath: /preview-pre-generate.sh
                  name: scripts
                  subPath: preview-pre-generate.sh
          volumes:
            - name: scripts
              configMap:
                name: nextcloud-scripts
                defaultMode: 0755
