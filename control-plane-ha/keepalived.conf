# /etc/keepalived/keepalived.conf
# Configuration File for keepalived
global_defs {
    router_id LVS_DEVEL
}
vrrp_script check_apiserver {
  script "/etc/keepalived/check_apiserver.sh"
  interval 3
  weight -2
  fall 10
  rise 2
}

vrrp_instance VI_1 {
    # MASTER for "first" control-plane node, BACKUP for all others. virtual IP will get assigned to MASTER initially.
    state MASTER
    # interface for LAN, typically eth0, but could be other things also
    interface enp2s0f1
    # virtual router ID, can be anything, but should be the same for all nodes
    virtual_router_id 51
    # higher on master, lower on backups. 101, 51, and 1 are likely fine for the 3 nodes.
    priority 101
    authentication {
        auth_type PASS
        # authentication password, needs to be same across all nodes
        auth_pass us4tDxzFTZbZsqrJcjXVT8hnke68s6MQ
    }
    virtual_ipaddress {
        # IP address that DNS A record should resolve to, must be unused in network
        192.168.1.100
    }
    track_script {
        check_apiserver
    }
}
