version: '3.7'

services:
  bazarr:
    image: linuxserver/bazarr:latest
    container_name: bazarr
    env_file:
      - lsio.env
    healthcheck:
      test: curl --max-time 5 -ILs --fail http://localhost:6767 || exit 1
      retries: 5
      start_period: 30s
    restart: unless-stopped
    volumes:
      - ./bazarr:/config
      - /mnt/hubbe/array/Videos/Movies:/movies
      - /mnt/hubbe/array/Videos/Shows:/tv
  calibre:
    image: linuxserver/calibre-web:latest
    container_name: calibre
    env_file:
      - lsio.env
    environment:
      - DOCKER_MODS=linuxserver/calibre-web:calibre
    healthcheck:
      test: curl --max-time 5 -ILs --fail http://localhost:8083 || exit 1
    restart: unless-stopped
    volumes:
      - ./calibre:/config
      - /mnt/hubbe/array/Books:/books
  db:
    image: linuxserver/mariadb:latest
    container_name: db
    env_file:
      - lsio.env
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
    restart: unless-stopped
    volumes:
      - ./mariadb:/config
  documentserver:
    image: onlyoffice/documentserver:latest
    container_name: documentserver
    healthcheck:
      test: curl --max-time 5 -ILs --fail http://localhost:80/healthcheck || exit 1
    restart: unless-stopped
  hubbot:
    image: hubbeking/hubbot:latest
    container_name: hubbot
    restart: unless-stopped
    volumes:
      - ./hubbot/data:/app/hubbot/data
      - ./hubbot/logs:/app/hubbot/logs
      - ./hubbot/dbchat.toml:/app/hubbot.toml
  jackett:
    image: linuxserver/jackett:latest
    container_name: jackett
    env_file:
      - lsio.env
    healthcheck:
      test: curl http://localhost:9117 || exit 1
    restart: unless-stopped
    volumes:
      - ./jackett/config:/config
      - ./jackett/downloads:/downloads
  jellyfin:
    image: linuxserver/jellyfin:latest
    container_name: jellyfin
    devices:
      - /dev/dri:/dev/dri
    env_file:
      - lsio.env
    healthcheck:
      test: curl --max-time 5 -Ls --fail http://localhost:8096/web/index.html || exit 1
    restart: unless-stopped
    volumes:
      - ./jellyfin/config:/config
      - ./jellyfin/transcode:/transcode
      - /mnt/hubbe/array/Videos/Shows:/tvshows
      - /mnt/hubbe/array/Videos/Movies:/movies
      - /mnt/hubbe/array/Music:/music
  nextcloud:
    image: linuxserver/nextcloud:latest
    container_name: nextcloud
    depends_on:
      - db
    env_file:
      - lsio.env
    healthcheck:
      test: curl --max-time 5 -kILs --fail https://localhost:443 || exit 1
    restart: unless-stopped
    volumes:
      - ./nextcloud/data:/data
      - ./nextcloud/config:/config
      - /mnt/hubbe/array:/mnt/hubbe/array:ro
  qbittorrent:
    image: linuxserver/qbittorrent:latest
    container_name: qbittorrent
    env_file:
      - lsio.env
    healthcheck:
      test: curl --max-time 5 -ILs --fail http://localhost:8080 || exit 1
    ports:
      - 62881:62881
      - 62881:62881/udp
    restart: unless-stopped
    volumes:
      - ./qbittorrent:/config
      - /mnt/hubbe/array/Downloads:/downloads
      - /mnt/hubbe/array/Videos:/videos
  radarr:
    image: linuxserver/radarr:latest
    container_name: radarr
    env_file:
      - lsio.env
    healthcheck:
      test: curl --max-time 5 -ILs --fail http://localhost:7878 || exit 1
    restart: unless-stopped
    volumes:
      - ./radarr:/config
      - /mnt/hubbe/array/Videos/Movies:/movies
      - /mnt/hubbe/array/Downloads:/downloads
  rss:
    image: linuxserver/tt-rss:latest
    container_name: rss
    depends_on:
      - db
    env_file:
      - lsio.env
    healthcheck:
      test: curl --max-time 5 -ILs --fail http://localhost:80 || exit 1
    restart: unless-stopped
    volumes:
      - ./rss:/config
  sonarr:
    image: linuxserver/sonarr:preview
    container_name: sonarr
    env_file:
      - lsio.env
    healthcheck:
      test: curl --max-time 5 -ILs --fail http://localhost:8989 || exit 1
    restart: unless-stopped
    volumes:
      - ./sonarr:/config
      - /mnt/hubbe/array/Videos/Shows:/tv
      - /mnt/hubbe/array/Downloads:/downloads
  sync:
    image: linuxserver/syncthing:latest
    container_name: sync
    env_file:
      - lsio.env
    healthcheck:
      test: nc -z localhost 8384 || exit 1
    ports:
      - "22000:22000"
      - "21027:21027/udp"
    restart: unless-stopped
    volumes:
      - ./sync:/config
      - /mnt/hubbe/array/Sync:/sync
  unifi:
    image: linuxserver/unifi-controller:latest
    container_name: unifi
    env_file:
      - lsio.env
    healthcheck:
      test: curl --max-time 5 -kILs --fail https://localhost:8443 || exit 1
    ports:
      - 3478:3478/udp
      - 10001:10001/udp
      - 8080:8080
      - 8081:8081
      - 8843:8843
      - 8880:8880
      - 6789:6789
    restart: unless-stopped
    volumes:
      - ./unifi:/config

networks:
  default:
    external: true
    name: web
